##### LOCAWEB - NAO REMOVER #####
#AddHandler php71-script .php
#suPHP_ConfigPath /home/esteticamimo/
##### LOCAWEB - NAO REMOVER #####
RewriteEngine On
RewriteCond %{SERVER_PORT} 80
RewriteRule ^(.*)$ https://www.minhamimo.com.br/$1 [R,L]

# Custom 404 Error Page
ErrorDocument 404 /404.php

# Cache Headers para Assets Estáticos
# CSS e JS versionados - cache longo (1 ano)
<FilesMatch "\.(css|js)$">
    <If "%{QUERY_STRING} =~ /v=|version=/">
        Header set Cache-Control "public, max-age=31536000, immutable"
        Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
    </If>
</FilesMatch>

# Imagens - cache longo (1 ano) - inclui AVIF
<FilesMatch "\.(jpg|jpeg|png|gif|webp|avif|svg|ico)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
</FilesMatch>

# Fontes - cache longo (1 ano)
<FilesMatch "\.(woff|woff2|ttf|otf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
    Header set Expires "Thu, 31 Dec 2025 23:59:59 GMT"
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

# HTML/PHP - NO CACHE (força sempre buscar versão nova)
# Desabilitar ETag completamente (pode causar 304 mesmo com no-cache)
FileETag None

<FilesMatch "\.(html|htm|php)$">
    <IfModule mod_headers.c>
        # Remover ETag e Last-Modified se existirem
        Header unset ETag
        Header unset Last-Modified
        
        # Headers agressivos para bypassar cache Varnish da Locaweb
        # 'private' força bypass de cache compartilhado (Varnish/CDN)
        # IMPORTANTE: Headers devem estar nesta ordem para Varnish respeitar
        Header always set Cache-Control "private, no-cache, no-store, must-revalidate, proxy-revalidate, max-age=0, s-maxage=0"
        Header always set Pragma "no-cache"
        Header always set Expires "Thu, 01 Jan 1970 00:00:00 GMT"
        # Vary: Cookie é CRUCIAL - força Varnish a criar cache diferente por cookie
        # Combinado com Set-Cookie de versão, isso bypassa completamente o cache fixo
        Header always set Vary "Accept-Encoding, User-Agent, Cookie"
        
        # Headers específicos para Varnish/Nginx (Locaweb usa Varnish)
        Header always set X-Accel-Expires "0"
        Header always set X-Cache-Status "BYPASS"
        Header always set X-Cache-Control "no-cache"
        
        # Forçar Varnish a não cachear (Surrogate-Control é específico para Varnish)
        Header always set Surrogate-Control "no-store"
    </IfModule>
</FilesMatch>

# Ativar módulo headers se disponível
<IfModule mod_headers.c>
    # Vary header para compressão
    <FilesMatch "\.(css|js)$">
        Header append Vary Accept-Encoding
    </FilesMatch>
</IfModule>